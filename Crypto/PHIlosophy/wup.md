# Đề bài

![image](https://github.com/anhshidou/AngstromCTF2024/assets/90485791/bf1b3c47-8caa-4632-b79b-99c862ced805)

# Source

```
from Crypto.Util.number import getPrime
from secret import flag

p = getPrime(512)
q = getPrime(512)

m = int.from_bytes(flag.encode(), "big")

n = p * q
e = 65537
c = pow(m, e, n)

phi = (p + 1) * (q + 1)

print(f"n: {n}")
print(f"e: {e}")
print(f"c: {c}")
print(f"\"phi\": {phi}")

"""
n: 86088719452932625928188797700212036385645851492281481088289877829109110203124545852827976798704364393182426900932380436551569867036871171400190786913084554536903236375579771401257801115918586590639686117179685431627540567894983403579070366895343181435791515535593260495162656111028487919107927692512155290673
e: 65537
c: 64457111821105649174362298452450091137161142479679349324820456191542295609033025036769398863050668733308827861582321665479620448998471034645792165920115009947792955402994892700435507896792829140545387740663865218579313148804819896796193817727423074201660305082597780007494535370991899386707740199516316196758
"phi": 86088719452932625928188797700212036385645851492281481088289877829109110203124545852827976798704364393182426900932380436551569867036871171400190786913084573410416063246853198167436938724585247461433706053188624379514833802770205501907568228388536548010385588837258085711058519777393945044905741975952241886308
"""
```

# Phân tích

Đề bài sử dụng mã hóa RSA-512 nhưng mà lại chỉnh sửa một chút ở chỗ tính phi: Thay vì tính $\phi = (p - 1) \times (q - 1)$ thì source lại tính $\phi = (p + 1) \times (q + 1)$ và in ra màn hình

Sử dụng chính cái phi giả được đề bài cho, cùng một chút biến đổi, ta có thể nhận được phi thật ( $\phi = (p - 1) \times (q - 1)$ )

Có:

$$(p + 1) \times (q + 1) + (p - 1) \times (q - 1) = 2pq + 2$$

Suy ra:

$$(p - 1) \times (q - 1) = 2n + 2 - (p + 1) \times (q + 1)$$

# Lời giải

```
from Crypto.Util.number import *

n = 86088719452932625928188797700212036385645851492281481088289877829109110203124545852827976798704364393182426900932380436551569867036871171400190786913084554536903236375579771401257801115918586590639686117179685431627540567894983403579070366895343181435791515535593260495162656111028487919107927692512155290673
e = 65537
c = 64457111821105649174362298452450091137161142479679349324820456191542295609033025036769398863050668733308827861582321665479620448998471034645792165920115009947792955402994892700435507896792829140545387740663865218579313148804819896796193817727423074201660305082597780007494535370991899386707740199516316196758
phiFake = 86088719452932625928188797700212036385645851492281481088289877829109110203124545852827976798704364393182426900932380436551569867036871171400190786913084573410416063246853198167436938724585247461433706053188624379514833802770205501907568228388536548010385588837258085711058519777393945044905741975952241886308

phi = 2*n + 2 - phiFake
d = inverse(e, phi)
plain = pow(c, d, n)

print(long_to_bytes(plain))
```

# Flag

`actf{its_okay_i_figured_out_phi_anyway}`
